{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="/static/fonts/remixicon/remixicon.css">
<style>
    :root {
        --primary-color: #2563eb;
        --primary-hover: #1d4ed8;
        --secondary-color: #7c3aed;
        --background-color: #ffffff;
        --text-color: #333333;
        --border-color: #e0e0e0;
        --error-color: #ef4444;
        --success-color: #10b981;
        --input-bg: #f9fafb;
        --card-bg: rgba(255, 255, 255, 0.95);
        --input-placeholder: #94a3b8;
        --input-text: #333333;
        --step-inactive: #e0e0e0;
    }

    [data-theme="dark"] {
        --background-color: #1c1c1e;
        --text-color: #ffffff;
        --border-color: #3d3d42;
        --input-bg: #2a2a2c;
        --card-bg: rgba(40, 40, 45, 0.92);
        --input-placeholder: #9ca3af;
        --input-text: #ffffff;
        --step-inactive: #4a4a4c;
    }

    body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        position: relative;
        overflow-x: hidden;
        overflow-y: auto;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        transition: background 0.3s ease;
        padding: 40px 0;
    }

    /* 允许输入框可选中 */
    input {
        user-select: text !important;
        -webkit-user-select: text !important;
        -moz-user-select: text !important;
        -ms-user-select: text !important;
    }

    /* 添加动态背景 */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        z-index: 0;
        opacity: 0.6;
        animation: backgroundShimmer 100s infinite linear;
        pointer-events: none;
    }

    @keyframes backgroundShimmer {
        0% { background-position: 0 0; }
        100% { background-position: 100% 100%; }
    }

    .container {
        width: 100%;
        max-width: 420px;
        padding: 20px;
        position: relative;
        z-index: 1;
        margin: 20px auto;
    }

    .card {
        background: var(--card-bg);
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(16px);
        transform: translateY(0);
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        position: relative;
        overflow: hidden;
        min-height: 400px;
        display: flex;
        flex-direction: column;
    }

    /* 添加卡片背景装饰 */
    .card::before {
        content: '';
        position: absolute;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, var(--primary-color) 0%, transparent 70%);
        top: -150px;
        right: -150px;
        opacity: 0.05;
        border-radius: 50%;
    }

    .card::after {
        content: '';
        position: absolute;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, var(--secondary-color) 0%, transparent 70%);
        bottom: -100px;
        left: -100px;
        opacity: 0.05;
        border-radius: 50%;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.15);
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
    }

    .header h1 {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin: 0;
        font-size: 32px;
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .header p {
        color: var(--text-color);
        opacity: 0.7;
        margin: 10px 0 0;
        font-size: 16px;
    }

    .form-group {
        margin-bottom: 24px;
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-color);
        font-weight: 500;
        font-size: 15px;
    }

    .form-group input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        background: var(--input-bg);
        color: var(--input-text);
        font-size: 16px;
        transition: all 0.25s ease;
        box-sizing: border-box;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
    }

    .form-group input::placeholder {
        color: var(--input-placeholder);
        opacity: 0.8;
    }

    .form-group input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    }

    .button {
        width: 100%;
        padding: 16px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.1s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
    }

    .button:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(37, 99, 235, 0.25);
    }

    .button:active {
        transform: translateY(0);
    }

    /* 添加按钮点击效果 */
    .button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%, -50%);
        transform-origin: 50% 50%;
    }

    .button:active::after {
        animation: ripple 0.6s ease-out;
    }

    @keyframes ripple {
        0% {
            transform: scale(0, 0);
            opacity: 0.5;
        }
        100% {
            transform: scale(20, 20);
            opacity: 0;
        }
    }

    .message {
        text-align: center;
        margin-top: 15px;
        padding: 14px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 500;
        display: none;
        animation: fadeInUp 0.3s ease;
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .message.error {
        background: rgba(239, 68, 68, 0.1);
        color: var(--error-color);
    }

    .message.success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    .login-link {
        text-align: center;
        margin-top: 24px;
    }

    .login-link a {
        color: var(--primary-color);
        text-decoration: none;
        font-size: 15px;
        font-weight: 500;
        transition: all 0.2s;
    }

    .login-link a:hover {
        color: var(--primary-hover);
        text-decoration: underline;
    }

    .resend-section {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 15px 0;
    }

    .resend-button {
        color: var(--primary-color);
        background: none;
        border: none;
        padding: 0;
        font: inherit;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .resend-button:hover {
        color: var(--primary-hover);
    }

    .countdown {
        color: var(--text-color);
        opacity: 0.7;
        font-size: 14px;
    }

    .step {
        display: none;
    }

    .step.active {
        display: block;
        animation: fadeInUp 0.3s ease;
    }

    .password-strength {
        margin-top: 10px;
        height: 6px;
        border-radius: 3px;
        background: var(--border-color);
        overflow: hidden;
    }

    .password-strength-bar {
        height: 100%;
        width: 0;
        transition: all 0.3s;
        border-radius: 3px;
    }

    .strength-weak { 
        width: 33.33%; 
        background: var(--error-color); 
    }
    .strength-medium { 
        width: 66.66%; 
        background: #ffcc00; 
    }
    .strength-strong { 
        width: 100%; 
        background: var(--success-color); 
    }

    .password-tips {
        margin-top: 8px;
        font-size: 13px;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .password-tips .icon {
        font-size: 14px;
        display: inline-flex;
        align-items: center;
    }

    .password-tips .text {
        flex: 1;
    }

    .password-toggle {
        position: absolute;
        right: 12px;
        top: 39px;
        background: none;
        border: none;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-color);
        opacity: 0.6;
        transition: all 0.2s ease;
        z-index: 10;
        font-size: 16px;
    }

    .password-toggle:hover {
        opacity: 1;
    }

    .form-group input[type="password"],
    .form-group input[type="text"] {
        padding-right: 40px;
        box-sizing: border-box;
        width: 100%;
    }

    /* 主题切换按钮样式 */
    .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .theme-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
    }

    .theme-toggle .icon {
        font-size: 20px;
        color: white;
        transition: all 0.3s ease;
    }

    [data-theme="dark"] .theme-toggle {
        background: rgba(30, 30, 30, 0.6);
        border-color: rgba(80, 80, 80, 0.3);
    }

    [data-theme="dark"] .theme-toggle .icon {
        color: #FFD700; /* 深色模式下的图标颜色 */
    }

    /* 深色模式下的特定调整 */
    [data-theme="dark"] .message.error {
        background: rgba(239, 68, 68, 0.2);
    }

    [data-theme="dark"] .message.success {
        background: rgba(16, 185, 129, 0.2);
    }

    [data-theme="dark"] .password-toggle {
        color: #e0e0e0;
    }

    /* 深色模式下输入框样式增强 */
    [data-theme="dark"] .form-group input {
        border-color: var(--border-color);
        box-shadow: 0 0 0 1px rgba(80, 80, 95, 0.3);
    }

    [data-theme="dark"] .form-group input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3), 0 0 0 1px var(--primary-color);
    }

    [data-theme="dark"] .form-group input:hover:not(:focus) {
        border-color: #4d4d52;
        box-shadow: 0 0 0 1px rgba(100, 100, 120, 0.4);
    }

    /* 深色模式下链接和按钮颜色 */
    [data-theme="dark"] .login-link a {
        color: #5e9eff;
    }

    [data-theme="dark"] .login-link a:hover {
        color: #7fb2ff;
    }

    [data-theme="dark"] .resend-button {
        color: #5e9eff;
    }

    [data-theme="dark"] .resend-button:hover {
        color: #7fb2ff;
    }

    [data-theme="dark"] .resend-button.disabled {
        color: #4a4a4c;
    }

    /* 步骤指示器样式 */
    .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        position: relative;
        width: 80px;
        margin-left: auto;
        margin-right: auto;
    }

    .step-indicator::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 10px;
        right: 10px;
        height: 2px;
        background-color: var(--step-inactive);
        transform: translateY(-50%);
        z-index: 0;
    }

    .step {
        display: none;
        opacity: 0;
        transform: translateY(20px);
    }

    .step.active {
        display: block;
        animation: fadeInStep 0.5s ease forwards;
    }

    @keyframes fadeInStep {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .step-circle {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background-color: var(--step-inactive);
        margin: 0 12px;
        position: relative;
        z-index: 1;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .step-circle.active {
        background-color: var(--primary-color);
        transform: scale(1.2);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
    }

    .step-indicator.step2::before {
        background-image: linear-gradient(to right, var(--primary-color) 50%, var(--step-inactive) 50%);
    }

    /* 步骤切换效果 */
    .form-container {
        position: relative;
        min-height: 280px;
        max-height: 450px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    /* 自定义滚动条样式 */
    body::-webkit-scrollbar {
        width: 10px;
    }

    body::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
    }

    body::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 5px;
    }

    [data-theme="dark"] body::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
    }

    /* 改进步骤动画效果 */
    .slide-enter-active {
        animation: slideIn 0.5s ease-out forwards;
        max-height: 100%;
        overflow-y: visible;
    }

    .slide-exit-active {
        animation: slideOut 0.5s ease-out forwards;
        max-height: 100%;
        overflow: hidden;
    }

    #step2 {
        height: auto;
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideOut {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(-30px); }
    }

    /* 加载效果样式 */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(3px);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }

    .loading-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: var(--primary-color);
        animation: spin 1s infinite linear;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* 按钮禁用状态 */
    .button:disabled {
        background-color: var(--border-color);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    [data-theme="dark"] .button:disabled {
        background-color: #3d3d42;
    }

    /* 添加图形验证码相关样式 */
    .captcha-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    
    .captcha-image {
        width: 120px;
        height: 46px;
        background-color: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Courier New', monospace;
        font-size: 18px;
        font-weight: bold;
        color: #333;
        letter-spacing: 2px;
        cursor: pointer;
        user-select: none;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .captcha-image:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .captcha-canvas {
        width: 100%;
        height: 100%;
    }

    [data-theme='dark'] .captcha-image {
        background-color: #2a2a2a;
        color: #ddd;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* 滑动验证码样式 */
    .slider-captcha-container {
        margin-top: 15px;
        width: 100%;
        position: relative;
        display: none;
    }

    .slider-captcha-track {
        height: 40px;
        background-color: #f5f5f5;
        border-radius: 20px;
        position: relative;
        overflow: hidden;
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .slider-captcha-thumb {
        width: 50px;
        height: 40px;
        background: var(--primary-color);
        border-radius: 20px;
        position: absolute;
        left: 0;
        top: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 18px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 10;
        transition: background-color 0.3s;
        will-change: left;
        touch-action: none;
    }

    .slider-captcha-thumb:hover {
        background-color: var(--primary-hover);
    }

    .slider-captcha-track-inner {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 0;
        background: linear-gradient(to right, rgba(37, 99, 235, 0.2), rgba(37, 99, 235, 0.3));
        border-radius: 20px;
        will-change: width;
        pointer-events: none;
    }

    .slider-captcha-text {
        position: absolute;
        width: 100%;
        text-align: center;
        line-height: 40px;
        color: #888;
        font-size: 14px;
        user-select: none;
        z-index: 5;
    }

    .slider-captcha-success .slider-captcha-track-inner {
        background: linear-gradient(to right, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4));
        width: 100% !important;
    }

    .slider-captcha-success .slider-captcha-thumb {
        background-color: var(--success-color);
        left: calc(100% - 50px) !important;
    }

    .slider-captcha-success .slider-captcha-text {
        color: var(--success-color);
        font-weight: 600;
    }

    [data-theme='dark'] .slider-captcha-track {
        background-color: #333;
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    [data-theme='dark'] .slider-captcha-track-inner {
        background: linear-gradient(to right, rgba(37, 99, 235, 0.3), rgba(37, 99, 235, 0.4));
    }

    [data-theme='dark'] .slider-captcha-text {
        color: #aaa;
    }

    /* 添加图标样式 */
    i {
        line-height: 0;
    }
    
    .form-group label i {
        margin-right: 8px;
        font-size: 16px;
        color: var(--primary-color);
        position: relative;
        top: -1px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 0;
    }

    .button i {
        margin-right: 8px;
        font-size: 18px;
        position: relative;
        top: -1px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 0;
    }

    .login-link a i {
        margin-right: 8px;
        font-size: 14px;
        position: relative;
        top: -1px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 0;
    }

    /* 密码切换图标样式 */
    .password-toggle i {
        font-size: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        vertical-align: -0.125em;
    }
    
    /* 滑动验证码图标样式 */
    .slider-captcha-thumb i {
        font-size: 20px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
    }

    /* 主题切换按钮图标 */
    .theme-toggle .icon i {
        font-size: 20px;
        color: white;
        transition: all 0.3s ease;
    }

    /* 深色模式下的图标颜色调整 */
    [data-theme="dark"] .form-group label i {
        color: #5e9eff;
    }

    [data-theme="dark"] .theme-toggle .icon i {
        color: #FFD700; /* 深色模式下的图标颜色 */
    }

    .header h1 i {
        margin-right: 8px;
        font-size: 28px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 0;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
</style>

<div class="container">
    <div class="card">
        <div class="header">
            <h1><i class="ri-lock-unlock-line"></i>重置密码</h1>
            <p>数据分析系统</p>
        </div>
        
        <!-- 步骤指示器 -->
        <div id="stepIndicator" class="step-indicator">
            <div id="step1Circle" class="step-circle active"></div>
            <div id="step2Circle" class="step-circle"></div>
        </div>
        
        <div class="form-container">
            <!-- 第一步：输入邮箱 -->
            <div id="step1" class="step active">
                <form id="emailForm" onsubmit="return false;">
                    <div class="form-group">
                        <label for="email"><i class="ri-mail-line"></i>邮箱地址</label>
                        <input type="email" id="email" required placeholder="请输入注册时使用的邮箱">
                    </div>

                    <div class="form-group">
                        <label for="image-captcha"><i class="ri-shield-check-line"></i>图形验证码</label>
                        <div class="captcha-container">
                            <input type="text" id="image-captcha" placeholder="请输入验证码" required>
                            <div id="captcha-image" class="captcha-image" title="点击刷新验证码">
                                <canvas id="captcha-canvas" class="captcha-canvas"></canvas>
                            </div>
                        </div>
                        <div id="slider-captcha" class="slider-captcha-container">
                            <div class="slider-captcha-track">
                                <div class="slider-captcha-text">请向右滑动滑块完成验证</div>
                                <div class="slider-captcha-track-inner"></div>
                                <div class="slider-captcha-thumb"><i class="ri-arrow-right-line"></i></div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="sendCodeBtn" class="button"><i class="ri-mail-send-line"></i>获取验证码</button>
                    <div id="countdown" class="countdown" style="display: none; text-align: center; margin-top: 15px;">
                        <span id="timer">60</span>秒后可重新发送
                    </div>
                </form>
            </div>

            <!-- 第二步：输入验证码和新密码 -->
            <div id="step2" class="step">
                <form id="resetForm" onsubmit="return false;">
                    <div class="form-group">
                        <label for="code"><i class="ri-key-2-line"></i>验证码</label>
                        <input type="text" id="code" required placeholder="请输入6位验证码">
                    </div>

                    <div class="form-group">
                        <label for="newPassword"><i class="ri-lock-password-line"></i>新密码</label>
                        <input type="password" id="newPassword" required placeholder="请输入新密码">
                        <button type="button" class="password-toggle" onclick="togglePassword('newPassword')" title="显示/隐藏密码">
                            <i class="ri-eye-line"></i>
                        </button>
                        <div class="password-strength">
                            <div id="strengthBar" class="password-strength-bar"></div>
                        </div>
                        <div id="passwordTips" class="password-tips">
                            <span class="icon" id="strengthIconSmall"></span>
                            <span class="text" id="tipsText">密码至少包含6个字符</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword"><i class="ri-check-line"></i>确认新密码</label>
                        <input type="password" id="confirmPassword" required placeholder="请再次输入新密码">
                        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')" title="显示/隐藏密码">
                            <i class="ri-eye-line"></i>
                        </button>
                    </div>

                    <button type="submit" id="resetBtn" class="button"><i class="ri-refresh-line"></i>重置密码</button>
                </form>
            </div>
        </div>
        
        <div id="message" class="message"></div>
        
        <div class="login-link">
            <a href="/login"><i class="ri-arrow-left-line"></i>返回登录</a>
        </div>
    </div>
</div>

<!-- 主题切换按钮 -->
<div class="theme-toggle" id="themeToggle">
    <div class="icon"><i class="ri-sun-line"></i></div>
</div>

<!-- 加载动画覆盖层 -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const emailForm = document.getElementById('emailForm');
    const resetForm = document.getElementById('resetForm');
    const sendCodeBtn = document.getElementById('sendCodeBtn');
    const resetBtn = document.getElementById('resetBtn');
    const countdown = document.getElementById('countdown');
    const timer = document.getElementById('timer');
    const message = document.getElementById('message');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle.querySelector('.icon i');
    let countdownInterval;
    
    // 初始化主题
    initTheme();
    
    // 当前验证码值和滑动验证状态
    let currentCaptcha = '';
    let sliderVerified = false;
    
    // 生成图形验证码
    function generateCaptcha() {
        const canvas = document.getElementById('captcha-canvas');
        const ctx = canvas.getContext('2d');
        
        // 设置canvas大小
        canvas.width = 120;
        canvas.height = 46;
        
        // 生成随机验证码
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789';
        currentCaptcha = '';
        for (let i = 0; i < 4; i++) {
            currentCaptcha += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        
        // 判断当前主题
        const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
        
        // 清空canvas - 使用更合适的背景色
        if (isDarkMode) {
            ctx.fillStyle = '#3a3a3c'; // 深色模式下使用更亮的背景色
        } else {
            ctx.fillStyle = '#f0f0f0';
        }
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 画干扰线 - 增加干扰线数量和复杂度
        for (let i = 0; i < 8; i++) {
            ctx.strokeStyle = isDarkMode ? 
                getRandomBrightColor(0.3) : // 深色模式使用亮色线条，但降低不透明度
                getRandomColor(0.25);
            ctx.lineWidth = 0.5 + Math.random() * 1.5; // 随机线宽
            ctx.beginPath();
            ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
            ctx.bezierCurveTo(
                Math.random() * canvas.width, Math.random() * canvas.height,
                Math.random() * canvas.width, Math.random() * canvas.height,
                Math.random() * canvas.width, Math.random() * canvas.height
            );
            ctx.stroke();
        }
        
        // 添加噪点
        for (let i = 0; i < 120; i++) {
            ctx.fillStyle = isDarkMode ? 
                getRandomBrightColor(0.4) : // 深色模式使用亮色噪点，但降低不透明度
                getRandomColor(0.4);
            ctx.beginPath();
            ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // 绘制验证码文字
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        for (let i = 0; i < currentCaptcha.length; i++) {
            const x = 20 + i * 25;
            const y = canvas.height / 2 + Math.random() * 8 - 4;
            ctx.font = `${isDarkMode ? 'bold' : ''} ${18 + Math.random() * 8}px sans-serif`;
            
            // 深色模式使用高对比度的亮色，但降低不透明度
            if (isDarkMode) {
                const color = getRandomHighContrastColor();
                const alpha = 0.7 + Math.random() * 0.2; // 70-90%不透明度
                ctx.fillStyle = color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
                
                // 减少阴影效果
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 1;
                ctx.shadowOffsetX = 0.5;
                ctx.shadowOffsetY = 0.5;
            } else {
                // 浅色模式下也降低文字不透明度
                const r = Math.floor(Math.random() * 100);
                const g = Math.floor(Math.random() * 100);
                const b = Math.floor(Math.random() * 150);
                const alpha = 0.6 + Math.random() * 0.3; // 60-90%不透明度
                ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
            }
            
            // 随机旋转角度
            const angle = Math.random() * 0.5 - 0.25; // 增加旋转角度范围
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            
            // 随机拉伸变形文字
            if (Math.random() > 0.5) {
                ctx.scale(1 + Math.random() * 0.2 - 0.1, 1);
            } else {
                ctx.scale(1, 1 + Math.random() * 0.2 - 0.1);
            }
            
            ctx.fillText(currentCaptcha[i], 0, 0);
            ctx.restore();
        }
        
        // 应用轻微高斯模糊效果
        try {
            // 尝试使用CSS滤镜实现模糊效果（仅部分浏览器支持）
            canvas.style.filter = 'blur(0.4px)';
        } catch (e) {
            // 忽略不支持的浏览器
        }
        
        // 显示滑动验证
        document.getElementById('slider-captcha').style.display = 'block';
        resetSlider();
        
        // 清空输入框
        document.getElementById('image-captcha').value = '';
    }

    // 获取随机颜色 (半透明)
    function getRandomColor(alpha = 1) {
        return `rgba(${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, ${alpha})`;
    }

    // 获取随机亮色 (用于深色模式)
    function getRandomBrightColor(alpha = 1) {
        // 使用较高的RGB值生成亮色
        return `rgba(${150 + Math.floor(Math.random() * 105)}, ${150 + Math.floor(Math.random() * 105)}, ${150 + Math.floor(Math.random() * 105)}, ${alpha})`;
    }

    // 获取高对比度颜色 (用于深色模式下的文字)
    function getRandomHighContrastColor() {
        const colors = [
            'rgb(255, 255, 0)', // 黄色
            'rgb(0, 255, 255)', // 青色
            'rgb(255, 0, 255)', // 洋红色
            'rgb(255, 136, 0)', // 橙色
            'rgb(136, 255, 0)', // 黄绿色
            'rgb(0, 255, 136)', // 青绿色
            'rgb(255, 255, 255)', // 白色
            'rgb(255, 136, 136)', // 浅红色
            'rgb(136, 255, 255)', // 浅青色
            'rgb(255, 255, 136)'  // 浅黄色
        ];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    // 初始化滑动验证
    function initSlider() {
        const slider = document.querySelector('.slider-captcha-thumb');
        const track = document.querySelector('.slider-captcha-track');
        const trackInner = document.querySelector('.slider-captcha-track-inner');
        const sliderContainer = document.querySelector('.slider-captcha-container');
        
        let isDragging = false;
        let startX = 0;
        let currentLeft = 0;
        
        // 监听滑块拖动事件
        slider.addEventListener('mousedown', function(e) {
            if (sliderContainer.classList.contains('slider-captcha-success')) return;
            
            isDragging = true;
            startX = e.clientX;
            currentLeft = parseInt(window.getComputedStyle(slider).left);
            
            // 移除任何过渡效果，确保实时更新
            slider.style.transition = 'none';
            trackInner.style.transition = 'none';
        });
        
        document.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            
            const trackWidth = track.clientWidth;
            const thumbWidth = slider.clientWidth;
            const maxLeft = trackWidth - thumbWidth;
            
            let newLeft = currentLeft + e.clientX - startX;
            newLeft = Math.max(0, Math.min(newLeft, maxLeft));
            
            // 立即更新滑块和轨道内部元素的位置，不使用动画
            slider.style.left = newLeft + 'px';
            trackInner.style.width = (newLeft + thumbWidth/2) + 'px';
        });
        
        document.addEventListener('mouseup', function() {
            if (!isDragging) return;
            
            isDragging = false;
            const currentLeft = parseInt(window.getComputedStyle(slider).left);
            const trackWidth = track.clientWidth;
            const thumbWidth = slider.clientWidth;
            const maxLeft = trackWidth - thumbWidth;
            
            // 只在松开鼠标且位置正确时验证成功
            if (currentLeft >= maxLeft - 10) {
                sliderSuccess();
            } else {
                // 滑动失败，回弹
                slider.style.transition = 'left 0.3s';
                trackInner.style.transition = 'width 0.3s';
                slider.style.left = '0px';
                trackInner.style.width = '0px';
                
                setTimeout(() => {
                    slider.style.transition = '';
                    trackInner.style.transition = '';
                }, 300);
            }
        });
        
        // 触摸设备支持
        slider.addEventListener('touchstart', function(e) {
            if (sliderContainer.classList.contains('slider-captcha-success')) return;
            
            isDragging = true;
            startX = e.touches[0].clientX;
            currentLeft = parseInt(window.getComputedStyle(slider).left);
            
            // 防止触摸事件引起页面滚动
            e.preventDefault();
            
            // 移除任何过渡效果，确保实时更新
            slider.style.transition = 'none';
            trackInner.style.transition = 'none';
        });
        
        document.addEventListener('touchmove', function(e) {
            if (!isDragging) return;
            
            const trackWidth = track.clientWidth;
            const thumbWidth = slider.clientWidth;
            const maxLeft = trackWidth - thumbWidth;
            
            let newLeft = currentLeft + e.touches[0].clientX - startX;
            newLeft = Math.max(0, Math.min(newLeft, maxLeft));
            
            // 立即更新滑块和轨道内部元素的位置，不使用动画
            slider.style.left = newLeft + 'px';
            trackInner.style.width = (newLeft + thumbWidth/2) + 'px';
            
            // 防止触摸事件引起页面滚动
            e.preventDefault();
        });
        
        document.addEventListener('touchend', function() {
            if (!isDragging) return;
            
            isDragging = false;
            const currentLeft = parseInt(window.getComputedStyle(slider).left);
            const trackWidth = track.clientWidth;
            const thumbWidth = slider.clientWidth;
            const maxLeft = trackWidth - thumbWidth;
            
            // 只在松开触摸且位置正确时验证成功
            if (currentLeft >= maxLeft - 10) {
                sliderSuccess();
            } else {
                // 滑动失败，回弹
                slider.style.transition = 'left 0.3s';
                trackInner.style.transition = 'width 0.3s';
                slider.style.left = '0px';
                trackInner.style.width = '0px';
                
                setTimeout(() => {
                    slider.style.transition = '';
                    trackInner.style.transition = '';
                }, 300);
            }
        });
    }

    // 滑动验证成功
    function sliderSuccess() {
        const sliderContainer = document.querySelector('.slider-captcha-container');
        const sliderText = document.querySelector('.slider-captcha-text');
        const sliderThumb = document.querySelector('.slider-captcha-thumb');
        const sliderIcon = sliderThumb.querySelector('i');
        
        sliderContainer.classList.add('slider-captcha-success');
        sliderText.textContent = '验证成功';
        sliderIcon.className = 'ri-check-line'; // 切换为对勾图标
        sliderVerified = true;
    }

    // 重置滑动验证
    function resetSlider() {
        const slider = document.querySelector('.slider-captcha-thumb');
        const trackInner = document.querySelector('.slider-captcha-track-inner');
        const sliderContainer = document.querySelector('.slider-captcha-container');
        const sliderText = document.querySelector('.slider-captcha-text');
        const sliderIcon = slider.querySelector('i');
        
        sliderContainer.classList.remove('slider-captcha-success');
        
        // 添加过渡效果使重置动画平滑
        slider.style.transition = 'left 0.2s';
        trackInner.style.transition = 'width 0.2s';
        
        slider.style.left = '0px';
        trackInner.style.width = '0px';
        sliderText.textContent = '请向右滑动滑块完成验证';
        sliderIcon.className = 'ri-arrow-right-line'; // 恢复为箭头图标
        sliderVerified = false;
        
        // 短暂延迟后移除过渡效果，确保下次拖动时没有延迟
        setTimeout(() => {
            slider.style.transition = 'none';
            trackInner.style.transition = 'none';
        }, 200);
    }

    // 显示加载动画
    function showLoading() {
        loadingOverlay.classList.add('active');
    }

    // 隐藏加载动画
    function hideLoading() {
        loadingOverlay.classList.remove('active');
    }

    // 开始倒计时
    function startCountdown() {
        let seconds = 60;
        sendCodeBtn.style.display = 'none';
        countdown.style.display = 'block';
        
        countdownInterval = setInterval(() => {
            seconds--;
            timer.textContent = seconds;
            
            if (seconds <= 0) {
                clearInterval(countdownInterval);
                sendCodeBtn.style.display = 'block';
                countdown.style.display = 'none';
            }
        }, 1000);
    }

    // 发送验证码
    emailForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const captchaInput = document.getElementById('image-captcha').value.trim();
        
        if (!email) {
            showMessage('请输入邮箱地址', 'error');
            return;
        }

        // 验证图形验证码
        if (!captchaInput) {
            showMessage('请输入图形验证码', 'error');
            return;
        }
        
        if (!sliderVerified) {
            showMessage('请完成滑动验证', 'error');
            return;
        }
        
        if (captchaInput.toLowerCase() !== currentCaptcha.toLowerCase()) {
            showMessage('图形验证码错误', 'error');
            generateCaptcha(); // 刷新验证码
            return;
        }

        // 禁用按钮并显示加载动画
        sendCodeBtn.disabled = true;
        showLoading();

        fetch('/api/reset-password/request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email })
        })
        .then(response => response.json())
        .then(data => {
            // 隐藏加载动画
            hideLoading();
            
            if (data.success) {
                showMessage('验证码已发送到您的邮箱', 'success');
                startCountdown();
                
                // 高亮步骤指示器
                document.getElementById('stepIndicator').classList.add('step2');
                document.getElementById('step1Circle').classList.remove('active');
                document.getElementById('step2Circle').classList.add('active');
                
                // 添加动画过渡效果
                step1.classList.add('slide-exit-active');
                
                setTimeout(() => {
                    // 显示第二步
                    step1.classList.remove('active', 'slide-exit-active');
                    step2.classList.add('active', 'slide-enter-active');
                    
                    setTimeout(() => {
                        step2.classList.remove('slide-enter-active');
                    }, 500);
                }, 400);
            } else {
                sendCodeBtn.disabled = false;
                showMessage(data.message || '发送验证码失败', 'error');
                generateCaptcha(); // 刷新验证码
            }
        })
        .catch(error => {
            // 隐藏加载动画并恢复按钮
            hideLoading();
            sendCodeBtn.disabled = false;
            console.error('Error:', error);
            showMessage('发送验证码失败，请稍后重试', 'error');
            generateCaptcha(); // 刷新验证码
        });
    });

    // 重置密码
    resetForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const code = document.getElementById('code').value.trim();
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // 检查密码强度
        const result = checkPasswordStrength(newPassword);
        if (result.strength <= 2) {
            showMessage('密码强度过弱，请选择更强的密码', 'error');
            return;
        }

        if (!code || !newPassword || !confirmPassword) {
            showMessage('请填写所有必需信息', 'error');
            return;
        }

        if (newPassword !== confirmPassword) {
            showMessage('两次输入的密码不一致', 'error');
            return;
        }

        if (newPassword.length < 6) {
            showMessage('密码长度不能小于6个字符', 'error');
            return;
        }

        fetch('/api/reset-password/verify', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                code: code,
                new_password: newPassword
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage('密码重置成功，正在跳转...', 'success');
                setTimeout(() => {
                    window.location.href = '/login';
                }, 1500);
            } else {
                showMessage(data.message || '重置密码失败', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showMessage('重置密码失败，请稍后重试', 'error');
        });
    });

    // 显示提示信息
    function showMessage(text, type) {
        message.textContent = text;
        message.className = `message ${type}`;
        message.style.display = 'block';
        
        if (type === 'error') {
            setTimeout(() => {
                message.style.display = 'none';
            }, 2000);
        }
    }

    // 检查密码强度
    function checkPasswordStrength(password) {
        let strength = 0;
        const tips = [];

        // 长度检查（更严格的长度要求）
        if (password.length < 6) {
            tips.push('密码至少包含6个字符');
        } else if (password.length >= 10) {
            strength += 2;  // 10个字符以上给2分
        } else {
            strength += 1;  // 6-9个字符给1分
        }

        // 包含数字
        if (/\d/.test(password)) {
            strength += 1;
        } else {
            tips.push('建议包含数字');
        }

        // 包含小写字母
        if (/[a-z]/.test(password)) {
            strength += 1;
        } else {
            tips.push('建议包含小写字母');
        }

        // 包含大写字母
        if (/[A-Z]/.test(password)) {
            strength += 1;
        } else {
            tips.push('建议包含大写字母');
        }

        // 包含特殊字符
        if (/[^A-Za-z0-9]/.test(password)) {
            strength += 1;
        } else {
            tips.push('建议包含特殊字符');
        }

        // 检查是否是连续的数字或字母
        if (/^(?:0123456789|1234567890|abcdefgh|qwerty|password|abc123)$/i.test(password)) {
            strength = Math.max(0, strength - 2);  // 如果是连续字符，降低强度
            tips.push('不建议使用连续的数字或字母');
        }

        // 检查重复字符
        if (/(.)\1{2,}/.test(password)) {
            strength = Math.max(0, strength - 1);  // 如果包含重复字符，降低强度
            tips.push('不建议使用重复的字符');
        }

        return {
            strength: strength,
            tips: tips.length > 0 ? tips.join('，') : '密码强度良好'
        };
    }

    // 更新密码强度显示
    const newPassword = document.getElementById('newPassword');
    const strengthBar = document.getElementById('strengthBar');
    const passwordTips = document.getElementById('passwordTips');

    newPassword.addEventListener('input', function() {
        const result = checkPasswordStrength(this.value);
        strengthBar.className = 'password-strength-bar';
        const strengthIconSmall = document.getElementById('strengthIconSmall');
        const tipsText = document.getElementById('tipsText');
        
        if (this.value.length === 0) {
            strengthBar.className = 'password-strength-bar';
            strengthIconSmall.textContent = '';
            tipsText.textContent = '密码至少包含6个字符';
            tipsText.style.color = 'var(--text-color)';
        } else if (result.strength <= 2) {
            strengthBar.classList.add('strength-weak');
            strengthIconSmall.textContent = '❌';
            tipsText.textContent = `弱：${result.tips}`;
            tipsText.style.color = 'var(--error-color)';
        } else if (result.strength <= 4) {
            strengthBar.classList.add('strength-medium');
            strengthIconSmall.textContent = '⚠️';
            tipsText.textContent = `中：${result.tips}`;
            tipsText.style.color = '#ffcc00';
        } else {
            strengthBar.classList.add('strength-strong');
            strengthIconSmall.textContent = '✅';
            tipsText.textContent = `强：${result.tips}`;
            tipsText.style.color = 'var(--success-color)';
        }
    });

    // 切换密码显示/隐藏
    window.togglePassword = function(inputId) {
        const input = document.getElementById(inputId);
        const button = input.nextElementSibling;
        const icon = button.querySelector('i');
        
        if (input.type === 'password') {
            input.type = 'text';
            button.style.opacity = '1';
            icon.className = 'ri-eye-off-line'; // 切换为闭眼图标
        } else {
            input.type = 'password';
            button.style.opacity = '0.6';
            icon.className = 'ri-eye-line'; // 切换回眼睛图标
        }
    }
    
    // 初始化主题功能
    function initTheme() {
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('.icon i');
        
        // 检查并应用保存的主题
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            // 设置正确的图标
            if (savedTheme === 'dark') {
                themeIcon.className = 'ri-moon-line';
            } else {
                themeIcon.className = 'ri-sun-line';
            }
        }
        
        // 主题切换事件处理
        themeToggle.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // 切换图标
            if (newTheme === 'dark') {
                themeIcon.className = 'ri-moon-line';
            } else {
                themeIcon.className = 'ri-sun-line';
            }
            
            // 添加过渡效果
            document.body.style.transition = 'background 0.3s ease';
            setTimeout(() => {
                document.body.style.transition = '';
            }, 300);
        });
        
        // 检查系统偏好设置
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('theme')) {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeIcon.className = 'ri-moon-line'; // 设置为月亮图标
        }
        
        // 监听系统主题变化
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                    // 更新图标
                    themeIcon.className = e.matches ? 'ri-moon-line' : 'ri-sun-line';
                }
            });
        }
    }

    // 初始化验证码
    generateCaptcha();
    initSlider();

    // 点击验证码刷新
    document.getElementById('captcha-image').addEventListener('click', generateCaptcha);

    // 监听主题变化，重新生成验证码
    if (themeToggle) {
        themeToggle.addEventListener('click', function() {
            // 延迟一下，等主题切换完成后再生成验证码
            setTimeout(generateCaptcha, 100);
        });
    }
});
</script>
{% endblock %} 